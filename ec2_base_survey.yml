---
- name: Provision ec2 instances based on the environment
  hosts: localhost
  connection: local
  gather_facts: False
  vars:
    instance_types:
      Small: t2.micro
      Medium: t2.small
      Large: t2.medium
      Extra Large: t2.large
    inst_type: "{{ instance_types[aws_size] }}"
    images:
      Windows2016: ami
      Windows2012:
      Linux: ami-942dd1f6
    image_type: "{{ images[aws_image] }}"
    environments:
      Production: subnet-7795e13e
      Non-Production: subnet-009aa7986b32c5b47
      Shared Services: subnet-ee8ef589
      DMZ: subnet-0316165c451c9a8d8
    aws_subnet: "{{ environments[aws_env] }}"

  tasks:
  - name: Launch instances
    ec2:
        key_name: np_kp_aws
        region: ap-southeast-2
        instance_type: "{{ inst_type }}"
        image: ami-942dd1f6
        wait: yes
        group: default
        count: "{{aws_inst_count}}"
        vpc_subnet_id: "{{ aws_subnet }}"
        assign_public_ip: no
        instance_tags:
          detname: "{{ aws_app_name }}"
          env: "{{ aws_env }}"
    register: ec2
