---
- name: Provision ec2 instances based on the environment
  hosts: localhost
  connection: local
  gather_facts: False
  vars:
    instance_types:
      Small: t2.micro
      Medium: t2.small
      Large: t2.medium
      Extra Large: t2.large
    inst_type: "{{ instance_types[aws_size] }}"

  tasks:
  - name: Launch instances
    ec2:
        key_name: np_kp_aws
        region: ap-southeast-2
        instance_type: "{{ inst_type }}"
        image: ami-942dd1f6
        wait: yes
        group: default
        count: "{{aws_inst_count}}"
        vpc_subnet_id: subnet-009aa7986b32c5b47
        assign_public_ip: no
        instance_tags:
          detname: myserv
          env: non-prod-test
    register: ec2
